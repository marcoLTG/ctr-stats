<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CTR Stats Tracker Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        /* Aprovechar mejor el ancho */
        .grid-layout { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 8px; /* Espacio entre botones */
        }

        /* Botones mucho m√°s grandes y llamativos */
        .power-card { 
            transition: all 0.1s; 
            border: 2px solid #374151;
            background-color: rgba(55, 65, 81, 0.5);
            padding: 20px 5px !important; /* M√°s espacio interno */
        }

        .active-press:active { 
            transform: scale(0.95); 
            background-color: #60a5fa; /* Color azul al tocar */
            border-color: #ffffff;
        }

        .flash-red {
            animation: flash 0.3s;
        }
        @keyframes flash {
            0% { background-color: #ef4444; }
            100% { background-color: transparent; }
        }
    </style>
</head>
<body class="bg-slate-900 text-white p-2 font-sans select-none">

    <header class="text-center my-2">
        <h1 class="text-xl font-black text-yellow-400 italic tracking-tighter text-shadow">CTR STATS COLLECTOR üèÅ</h1>
    </header>

    <main class="flex gap-2 mb-20">
        <section class="w-1/2 bg-slate-800 p-2 rounded-xl border-t-4 border-blue-500 shadow-2xl">
            <h2 class="text-center font-bold text-xs mb-2 text-blue-300 uppercase tracking-widest">David</h2>
            <div id="btns-David" class="grid-layout"></div>
        </section>

        <section class="w-1/2 bg-slate-800 p-2 rounded-xl border-t-4 border-red-500 shadow-2xl">
            <h2 class="text-center font-bold text-xs mb-2 text-red-300 uppercase tracking-widest">Marco</h2>
            <div id="btns-Marco" class="grid-layout"></div>
        </section>
    </main>

    <footer class="fixed bottom-4 left-0 right-0 flex justify-center gap-4 px-4">
        <button onclick="descargarExcel()" class="bg-green-600 hover:bg-green-500 text-white px-6 py-3 rounded-full font-bold shadow-2xl active-press flex items-center gap-2">
            <span>üíæ</span> EXCEL
        </button>
        <button onclick="confirmarReset()" class="bg-slate-700 text-white p-3 rounded-full shadow-xl active-press">
            <span>üîÑ</span>
        </button>
    </footer>

    <script>
        const poderes = [
            { id: "COMBO 3 MISILES", img: "3misiles.png" },
            { id: "COMBO 3 BOMBAS", img: "3bombas.png" },
            { id: "BOMBA ATRAS", img: "bomba_atras.png" },
            { id: "BURBUJAZO", img: "burbuja.png" },
            { id: "BURBUJAZO ATRAS", img: "burbuja_atras.png" },
            { id: "MISIL ATRAS", img: "misil_atras.png" },
            { id: "MISIL", img: "misil.png" },
            { id: "BOMBA", img: "bomba.png" },
            { id: "MASCARA", img: "mascara.png" },
            { id: "RAYO", img: "rayo.png" },
            { id: "DIMETAZO VOLADOR", img: "dimetazo.png" },
            { id: "ESPICHADA", img: "espichada.png" },
            { id: "RELOJ", img: "reloj.png" },
            { id: "NITRO", img: "nitro.png" },
            { id: "TNT VOLADOR", img: "tnt.png" }
        ];

        let stats = { David: {}, Marco: {} };
        poderes.forEach(p => { stats.David[p.id] = 0; stats.Marco[p.id] = 0; });

        let timer;
        let isLongPress = false;

        function crearInterfaz(jugador) {
            const div = document.getElementById(`btns-${jugador}`);
            poderes.forEach(p => {
                const card = document.createElement("div");
                card.className = "power-card flex flex-col items-center bg-slate-700/50 p-1 rounded-lg active-press touch-none";
                card.innerHTML = `
                    <img src="${p.img}" class="w-16 h-16 object-contain pointer-events-none mb-1" 
                         onerror="this.src='https://via.placeholder.com/32?text=?'">
                    <span id="count-${jugador}-${p.id}" class="text-base font-black text-yellow-400 leading-none">0</span>
                `;

                // Manejo de eventos para sumar y restar
                card.onpointerdown = (e) => {
                    isLongPress = false;
                    timer = setTimeout(() => {
                        restar(jugador, p.id, card);
                        isLongPress = true;
                    }, 600);
                };

                card.onpointerup = () => {
                    clearTimeout(timer);
                };

                card.onclick = () => {
                    if (!isLongPress) {
                        sumar(jugador, p.id);
                    }
                };

                div.appendChild(card);
            });
        }

        function sumar(jugador, poderId) {
            stats[jugador][poderId]++;
            actualizarDato(jugador, poderId);
            if (navigator.vibrate) navigator.vibrate(25);
        }

        function restar(jugador, poderId, elemento) {
            if (stats[jugador][poderId] > 0) {
                stats[jugador][poderId]--;
                actualizarDato(jugador, poderId);
                elemento.classList.add('flash-red');
                setTimeout(() => elemento.classList.remove('flash-red'), 300);
                if (navigator.vibrate) navigator.vibrate([40, 30, 40]);
            }
        }

        function actualizarDato(jugador, poderId) {
            document.getElementById(`count-${jugador}-${poderId}`).innerText = stats[jugador][poderId];
        }

        function descargarExcel() {
            const data = poderes.map(p => ({
                "Poder": p.id,
                "David": stats.David[p.id],
                "Marco": stats.Marco[p.id]
            }));
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "CTR_Stats");
            XLSX.writeFile(wb, `CTR_RESULTADOS.xlsx`);
        }

        function confirmarReset() {
            if(confirm("¬øReiniciar contadores?")) window.location.reload();
        }

        crearInterfaz("David");
        crearInterfaz("Marco");
    </script>
</body>
</html>

