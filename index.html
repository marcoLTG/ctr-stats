<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CTR Stats Tracker Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        body { background-color: #0f172a; overflow-x: hidden; }
        .grid-layout { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 10px; 
            width: 100%;
        }
        .power-card { 
            transition: all 0.1s; 
            border: 2px solid #374151;
            background-color: rgba(30, 41, 59, 0.7);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px 5px !important;
            border-radius: 12px;
        }
        .active-press:active { 
            transform: scale(0.95); 
            background-color: #3b82f6; 
            border-color: white;
        }
        .flash-red { animation: flash 0.3s forwards; }
        @keyframes flash { 
            0% { background-color: #ef4444; } 
            100% { background-color: rgba(30, 41, 59, 0.7); } 
        }
    </style>
</head>
<body class="p-2 font-sans select-none text-white">

    <h1 class="text-center text-2xl font-black text-yellow-400 italic mb-4">CTR STATS COLLECTOR üèÅ</h1>

    <main class="flex gap-4 mb-24">
        <section class="w-1/2 p-1 border-t-4 border-blue-500 bg-slate-800/50 rounded-xl">
            <h2 class="text-center font-bold text-blue-400 mb-2">DAVID</h2>
            <div id="btns-David" class="grid-layout"></div>
        </section>

        <section class="w-1/2 p-1 border-t-4 border-red-500 bg-slate-800/50 rounded-xl">
            <h2 class="text-center font-bold text-red-400 mb-2">MARCO</h2>
            <div id="btns-Marco" class="grid-layout"></div>
        </section>
    </main>

    <footer class="fixed bottom-4 left-0 right-0 flex justify-center gap-6 px-4 bg-slate-900/80 py-2">
        <button onclick="descargarExcel()" class="bg-green-600 px-10 py-4 rounded-full font-black shadow-2xl active-press">üíæ EXCEL</button>
        <button onclick="confirmarReset()" class="bg-slate-700 p-4 rounded-full active-press">üîÑ</button>
    </footer>

    <script>
        const poderes = [
            { id: "3 MISILES", img: "3misiles.png", keyD: "9", keyM: "q" },
            { id: "3 BOMBAS", img: "3bombas.png", keyD: "*", keyM: "w" },
            { id: "BOMBA ATRAS", img: "bomba_atras.png", keyD: ".", keyM: "e" },
            { id: "BURBUJAZO", img: "burbuja.png", keyD: "5", keyM: "r" },
            { id: "BURBUJAZO ATRAS", img: "burbuja_atras.png", keyD: "4", keyM: "t" },
            { id: "MISIL ATRAS", img: "misil_atras.png", keyD: "2", keyM: "a" },
            { id: "MISIL", img: "misil.png", keyD: "1", keyM: "s" },
            { id: "BOMBA", img: "bomba.png", keyD: "0", keyM: "d" },
            { id: "MASCARA", img: "mascara.png", keyD: "Enter", keyM: "f" },
            { id: "RAYO", img: "rayo.png", keyD: "3", keyM: "g" },
            { id: "DIMETAZO", img: "dimetazo.png", keyD: "7", keyM: "z" },
            { id: "ESPICHADA", img: "espichada.png", keyD: "8", keyM: "x" },
            { id: "RELOJ", img: "reloj.png", keyD: "6", keyM: "c" },
            { id: "NITRO", img: "nitro.png", keyD: "-", keyM: "v" },
            { id: "TNT", img: "tnt.png", keyD: "+", keyM: "b" }
        ];

        let stats = { David: {}, Marco: {} };
        poderes.forEach(p => { stats.David[p.id] = 0; stats.Marco[p.id] = 0; });

        function hablar(texto) {
            const m = new SpeechSynthesisUtterance(texto);
            m.lang = 'es-ES'; m.rate = 1.3;
            window.speechSynthesis.speak(m);
        }

        function crearInterfaz(jugador) {
            const div = document.getElementById(`btns-${jugador}`);
            poderes.forEach(p => {
                const card = document.createElement("div");
                card.className = "power-card active-press touch-none";
                card.id = `card-${jugador}-${p.id}`;
                card.innerHTML = `
                    <img src="${p.img}" class="w-10 h-10 object-contain mb-1" onerror="this.src='https://via.placeholder.com/50'">
                    <span id="count-${jugador}-${p.id}" class="text-3xl font-black text-yellow-400">0</span>
                `;

                let timer;
                card.onpointerdown = () => timer = setTimeout(() => restar(jugador, p.id), 600);
                card.onpointerup = () => clearTimeout(timer);
                card.onclick = () => sumar(jugador, p.id);
                div.appendChild(card);
            });
        }

        function sumar(jugador, poderId) {
            stats[jugador][poderId]++;
            actualizar(jugador, poderId);
            hablar(poderId);
            if (navigator.vibrate) navigator.vibrate(20);
        }

        function restar(jugador, poderId) {
            if (stats[jugador][poderId] > 0) {
                stats[jugador][poderId]--;
                actualizar(jugador, poderId);
                const el = document.getElementById(`card-${jugador}-${poderId}`);
                el.classList.add('flash-red');
                setTimeout(() => el.classList.remove('flash-red'), 300);
                hablar("Borrado");
            }
        }

        function actualizar(j, p) { document.getElementById(`count-${j}-${p}`).innerText = stats[j][p]; }

        // MANEJO DE TECLADO
        window.onkeydown = (e) => {
            const pD = poderes.find(p => p.keyD === e.key);
            const pM = poderes.find(p => p.keyM === e.key.toLowerCase());
            if (pD) sumar("David", pD.id);
            if (pM) sumar("Marco", pM.id);
        };

        function descargarExcel() {
            const data = poderes.map(p => ({ "Poder": p.id, "David": stats.David[p.id], "Marco": stats.Marco[p.id] }));
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "CTR");
            XLSX.writeFile(wb, "CTR_RESULTADOS.xlsx");
        }

        function confirmarReset() { if(confirm("¬øResetear?")) window.location.reload(); }

        crearInterfaz("David"); crearInterfaz("Marco");
    </script>
</body>
</html>
